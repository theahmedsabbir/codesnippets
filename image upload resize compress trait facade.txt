<?php
namespace App\ImageUpload;

use Illuminate\Support\Str;
use Illuminate\Support\Facades\File;
use Illuminate\Support\Facades\Config;
use Illuminate\Support\Facades\Storage;

use Image;
// use File;
// use Str;

class ImageUpload
{
    use ImageTrait, ImageDeleteTrait;

    protected $image;
    protected $imageName;
    protected $path;
    protected $location;
    protected $quality = 80;

    /**
     * upload function
     *
     * @param object $image
     * @param string $name
     * @param string $location
     * @param boolean $is_orignal
     * @param array $functions
     * @return string
     */

    public function upload($image, $name, $location, $is_orignal, $functions)
    {
        $this->image = $image;
        echo $this->imageName = Str::slug($name) . time() . '.' . $this->image->getClientOriginalExtension();
        $this->path = $location;
        $this->location =  $this->path .'/' . $this->imageName;

        // uploading original image   
        if ($is_orignal == true) {   
            $img = Image::make( $this->image )->save( $this->location, $this->quality );
        }  

        $this->executeBulkFunction($functions, 'image');
        return $this->imageName;
    }

    /**
     * remove function
     *
     * @param string $disk
     * @param object $file_obj
     * @param array $parameters
     * @return string
     */
    public function delete($imageName, $location, $functions = [])
    {
        $this->imageName = $imageName;
        $this->path = $location;

        // remove from original location 
        if (File::exists($this->path . '/' . $this->imageName)) {
            File::delete($this->path . '/' . $this->imageName);
        }

        // delete from subfolders
        $this->executeBulkFunction($functions, 'delete');
    }

    private function executeBulkFunction($functions, $prefix)
    {
        if(count($functions) > 0) {
            foreach($functions as $function) {
                $function = ucwords($function);
                // dd($prefix.str_replace(' ','',$function));
                $this->{$prefix.str_replace(' ','',$function)}();
            }
        }
    }


}



//image upload trait 

<?php  
namespace App\ImageUpload;

use Intervention\Image\Facades\Image;

trait ImageTrait{

	public function image300()
    {
        echo $this->imageName;
        // dd($this->imageName);
        $location =  $this->path .'/300/' . $this->imageName;

        $img = Image::make( $this->image );

        $img->resize(300, null, function ($constraint) {
            $constraint->aspectRatio();
        });

        $img->save( $location, $this->quality );
    }

    public function image600()
    {
        echo $this->imageName;
        // dd($this->imageName);
        $location =  $this->path .'/600/' . $this->imageName;

        $img = Image::make( $this->image );

        $img->resize(600, null, function ($constraint) {
            $constraint->aspectRatio();
        });

        $img->save( $location, $this->quality );
    }
}


//image delete trait 

<?php  
namespace App\ImageUpload;

trait ImageDeleteTrait{

	public function delete100()
    {
        if (File::exists($this->path . '/100/' . $this->imageName)) {
            File::delete($this->path . '/100/' . $this->imageName);
        }
    }

	public function delete400()
    {
        if (File::exists($this->path . '/400/' . $this->imageName)) {
            File::delete($this->path . '/400/' . $this->imageName);
        }
    }
}















